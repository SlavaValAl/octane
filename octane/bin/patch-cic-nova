#!/bin/bash

set -x

cd $(dirname $0)
[ -f "./functions" ] && . functions

[ -z "$1" ] && die "No env ID provided, exiting"

nodes=$(list_nodes $1 'controller')

for node in $nodes
    do
        scp ../patches/icehouse-juno-compat-for-new-controllers.patch \
            root@$node:/tmp/icehouse-juno-compat-for-new-controllers.patch
        ssh root@$node "cd /usr/lib/python2.7/dist-packages; 
            patch -p1 < /tmp/icehouse-juno-compat-for-new-controllers.patch"
    done
